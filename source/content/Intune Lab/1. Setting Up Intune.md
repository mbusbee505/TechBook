
# Signing Up

First things first, I had to sign up for the [Intune Free Trial](https://aka.ms/IntuneTrial), provided an email address and a few other pieces of info.

The trial allows for 25 users but we get all the same features as the paid version of the environment. 


![[1. Setting Up Intune-1.png]]

# Nuke The Security Defaults

Next up I needed to turn off the Entra security defaults so theres room for my conditional access policies to take effect without conflict. To do this I went to Entra > Overview > Properties > Manage security defaults and set it to `Disabled (not recommended)`. 

![[1. Setting Up Intune-2.png]]

When asked for the reason, I selected "My organization plans to use Conditional Access". 

# Uploading Corporate Workforce

Every good organization needs at least a few users, so to make things seem more real I'm going to upload to Entra a [CSV file of simulated User data](https://raw.githubusercontent.com/mbusbee505/IntuneLab/refs/heads/main/busbeecorp_user_import.csv) that makes up my fake company workforce.

To get to the user upload I went to Entra > Users > Bulk Operations > Bulk Create and selected my file in the search field. 

![[1. Setting Up Intune-3.png]]

If you need a fresh template for new users you can download one provided by Microsoft here as well.

To see that it worked I refreshed the page and went to the All Users section.

![[1. Setting Up Intune-4.png]]

# Setting Up Security Groups

I wanted a way to automate the group creation. I found its possible via a few PowerShell commands.

First make sure you have Microsoft Graph installed.

```
Install-Module Microsoft.Graph -Scope CurrentUser
```

Then connect to your tenant:

```
Connect-MgGraph -Scopes "Group.ReadWrite.All" -TenantID "<Your Tenant ID>"
```

The Tenant ID can be found by going to Entra > Overview

![[1. Setting Up Intune-5.png]]

After running this command for the first time like I was, you may have a pop-up browser window asking for permission to connect. Make sure to give it the access so you can continue running commands.

To test that the connection works run 

```
Get-MgContext
```

It should output some info about your Tenant like below. If this doesn't work you will need to check your connect command again and ensure you are using the right Tenant ID.

![[1. Setting Up Intune-6.png]]

Once I confirmed connection I ran the command below which added the following security groups to Entra. Since its a dynamic group, users and devices will be added to them automatically based on their properties.

- Exec
- HR
- Finance
- IT
- Sales
- Marketing
- Eng
- Support
- All-Devices
- All-iOS
- All-Android

```
# Map each DisplayName to its dynamic rule
$dynamicMap = @{
    'Exec'     = '(user.jobTitle -contains "Chief-")'
    'Human Resources'       = '(user.department -eq "Human Resources")'
    'Finance'  = '(user.department -eq "Finance")'
    'IT'       = '(user.department -eq "IT")'
    'Security'       = '(user.department -eq "Security")'
    'Research'       = '(user.department -eq "Research")'
    'Sales'    = '(user.department -eq "Sales")'
    'Marketing'= '(user.department -eq "Marketing")'
    'Engineering'      = '(user.department -eq "Engineering")'
    'Support'  = '(user.department -eq "Support")'
    'All-Devices' = '(device.deviceId -ne null)'      # dynamic **device** group
    'All-iOS'     = '(device.deviceOSType -contains "iOS")'
    'All-Android' = '(device.deviceOSType -contains "Android")'
}

foreach ($kv in $dynamicMap.GetEnumerator()) {
    $name = $kv.Key
    $rule = $kv.Value

    $params = @{
        DisplayName                 =  $name
        MailNickname                = ($name -replace '\s','')
        Description                 = "$name dynamic security group"
        SecurityEnabled             = $true          # keeps it a security group
        MailEnabled                 = $false
        GroupTypes                  = @('DynamicMembership')
        MembershipRule              = $rule
        MembershipRuleProcessingState = 'On'
    }

    New-MgGroup @params
}
```

![[1. Setting Up Intune-7.png]]

Once I saw the success screen come through I went to Entra > Groups > All Groups and found the groups added via PowerShell.

![[1. Setting Up Intune-8.png]]

According to Microsoft, it can take up to 24 hours for these groups to apply to users. While I waited for this to end I moved on to setting up a dynamic device group for Windows 11 devices.



![[1. Setting Up Intune-9.png]]

In the `Add dynamic query` page I added the following settings:

![[1. Setting Up Intune-10.png]]

